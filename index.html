<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=600, initial-scale=1">
<link rel="stylesheet" href="vendor/codemirror/codemirror.css">
<style>
.hackable {
  background: yellow;
  border: 1px solid black;
  border-radius: 0;
  padding: 0 4px;
  font-family: inherit;
  font-size: inherit;
}

.CodeMirror {
  height: auto;
}

.CodeMirror-scroll {
  overflow-x: auto;
  overflow-y: hidden;
}

.cm-s-faded { color: gray; }
.cm-s-faded .cm-keyword {opacity: 0.66;}
.cm-s-faded .cm-atom {opacity: 0.66;}
.cm-s-faded .cm-number {opacity: 0.66;}
.cm-s-faded .cm-def {opacity: 0.66;}
.cm-s-faded .cm-variable,
.cm-s-faded .cm-punctuation,
.cm-s-faded .cm-property,
.cm-s-faded .cm-operator {opacity: 0.66;}
.cm-s-faded .cm-variable-2 {opacity: 0.66;}
.cm-s-faded .cm-variable-3 {opacity: 0.66;}
.cm-s-faded .cm-comment {opacity: 0.66;}
.cm-s-faded .cm-string {opacity: 0.66;}
.cm-s-faded .cm-string-2 {opacity: 0.66;}
.cm-s-faded .cm-meta {opacity: 0.66;}
.cm-s-faded .cm-qualifier {opacity: 0.66;}
.cm-s-faded .cm-builtin {opacity: 0.66;}
.cm-s-faded .cm-bracket {opacity: 0.66;}
.cm-s-faded .cm-tag {opacity: 0.66;}
.cm-s-faded .cm-attribute {opacity: 0.66;}
.cm-s-faded .cm-header {opacity: 0.66;}
.cm-s-faded .cm-quote {opacity: 0.66;}
.cm-s-faded .cm-hr {opacity: 0.66;}
.cm-s-faded .cm-link {opacity: 0.66;}

ul.hackables {
  list-style-type: none;
  padding: 0;
}

ul.hackables li {
  display: inline-block;
  border: 1px dotted gray;
}

ul.hackables li a {
  display: inline-block;
  padding: 10px;
  text-decoration: none;
  color: black;
}

ul.hackables li a.selected {
  background: yellow;
  pointer-events: none;
}
</style>
<title>EZHack</title>
<p>You can safely edit <em>parts</em> of the the HTML, CSS, and JavaScript below by tinkering with widgets.</p>
<ul class="hackables">
  <li><a href="?hackable=flyswat">flyswat</a></li>
  <li><a href="?hackable=poundsplat">poundsplat</a></li>
  <li><a href="?hackable=type-the-word">type-the-word</a></li>
  <li><a href="?hackable=what-colour">what-colour</a></li>
</ul>
<div id="code"></div>
<script src="vendor/jquery.js"></script>
<script src="vendor/codemirror/codemirror.js"></script>
<script src="vendor/codemirror/xml.js"></script>
<script src="vendor/codemirror/css.js"></script>
<script src="vendor/codemirror/javascript.js"></script>
<script src="vendor/codemirror/htmlmixed.js"></script>
<script src="vendor/jscolor/jscolor.js"></script>
<script>
function ColorWidget(options) {
  this.codeMirror = options.codeMirror;
  this.value = this.codeMirror.getRange(options.from, options.to);
  this.$el = $('<input class="hackable"></input>')
    .attr('title', options.title || 'Click to edit color.');
  this.el = this.$el[0];
  this.marker = this.codeMirror.markText(options.from, options.to, {
    replacedWith: this.el
  });
  this.picker = new jscolor.color(this.el, {});
  this.picker.fromString(this.value);
  this.marker.changed();
}

ColorWidget.prototype = {};

var hackables = {
  'type-the-word': function(codeMirror) {
    new ColorWidget({
      from: {line:9, ch:23},
      to: {line:9, ch:29},
      codeMirror: codeMirror
    });
  }
};

$(function() {
  var hackable = 'type-the-word';

  try {
    hackable = window.location.search.match(/hackable=([A-Za-z0-9\-]+)/)[1];
  } catch (e) {}

  $.get('hackables/' + hackable + '/index.html', function(html) {
    var cm = CodeMirror($('#code')[0], {
      mode: 'htmlmixed',
      lineNumbers: true,
      lineWrapping: true,
      readOnly: true,
      viewportMargin: Infinity,
      theme: 'default faded',
      value: html
    });

    $('a[href="?hackable=' + hackable + '"]').addClass('selected');

    $('#code').on('keypress', function(e) {
      if (e.which == 32 && e.ctrlKey) {
        e.preventDefault();
        if (!cm.somethingSelected()) return;
        var sel = {
          from: cm.getCursor('from'), 
          to: cm.getCursor('to')
        };
        window.prompt('Selection is:', JSON.stringify(sel));
      }
    });

    if (hackable in hackables)
      hackables[hackable](cm);
  });
});
</script>
